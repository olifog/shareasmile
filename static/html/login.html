<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="static/css/login.css">
        <link rel="icon" href="static/email_images/logo.png">
        <title>Share A Smile Today</title>
    </head>

    <body>
        <form id="form" action="#">
            <img id="logo" src="static/email_images/logo.png" alt="">
            <div id="start"></div>
            <br>
            <label>
                <input id="password" type="password">
            </label>
            <div id="response" style="font-size:small;margin-top:5px"></div>
        </form>

        <script>
            function GetURLParameter(sParam) {
                var sPageURL = decodeURI(window.location.search.substring(1));
                var sURLVariables = sPageURL.split('&');
                for (var i = 0; i < sURLVariables.length; i++) {
                    var sParameterName = sURLVariables[i].split('=');
                    if (sParameterName[0] === sParam) {
                        return sParameterName[1];
                    }
                }
            }
            const name = GetURLParameter("name").replace(/\+/g,' ');
            function callREST(e) {
                e.preventDefault();
                var params = "username=" + name + "&password=" + document.getElementById("password").value;
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState === 4 && this.status === 200) {
                        window.location.href = '../../redeem/' + GetURLParameter("redeem");
                    } else if (this.readyState === 4 && this.status === 401) {
                        document.getElementById("response").innerHTML = "Sorry, wrong password.";
                    }
                };
                xhttp.open("POST", "/auth", true);
                xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                xhttp.send(params);
            }
            document.getElementById("form").addEventListener("submit", callREST, false)
            document.getElementById("start").innerHTML = "Hello <b>" + name + "</b>!<br>Please input your password below:";
        </script>
    </body>
</html>